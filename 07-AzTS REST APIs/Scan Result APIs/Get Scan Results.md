> The Azure Tenant Security Solution (AzTS) was created by the Core Services Engineering & Operations (CSEO) division at Microsoft, to help accelerate Microsoft IT's adoption of Azure. We have shared AzTS and its documentation with the community to provide guidance for rapidly scanning, deploying and operationalizing cloud resources, across the different stages of DevOps, while maintaining controls on security and governance.
<br>AzTS is not an official Microsoft product â€“ rather an attempt to share Microsoft CSEO's best practices with the community..

<br>

## **Get scan results - POST**

Get latest scan results for a subscription.

**Description**
<br/>
To get latest scan results, you need to pass Subscription Id. 

**Permissions**
You must have permission over subscription or resource group in the subscription with any of the following roles:
- Owner
- Contributor
- ServiceAdministrator
- CoAdministrator
- AccountAdministrator
- Security Reader
- Security Admin
> **Note:** If you have been recently granted access to a subscription, you would be access AzTS APIs after 24 hours as it takes 24 hours to refresh latest RBAC.

**Request URL**

``` PowerShell
POST https://<WebAPI-URL>/adhocscan/subscription/{subscriptionId}/ControlScanResult?api-version=1.0
```
> _Note:_<br/>
> _1. 'WebAPI-URL' varies per AzTS setup. You need to reach out to AzTS admin to get value for `<WebAPI-URL`> as mentioned [here](../README.md#setup-for-azts-admin-only)._<br/>
> _2. API will return 100 records of control scan result at a time. In order to get next set of records, you have to pass skipToken (available in API response) as part of next API request._<br/>
> _3. 'api-version' is an optional parameter. Current and default supported version: **1.0**_

<br/>

**URI Parameters**
|Name|Type|Description|Required?|
|----|----|----|----|
| SubscriptionId |  GUID|Subscription Id | Yes |

**Request Header**

|Param Name|Description|Required?
|----|----|----|
| Authorization| Bearer Token which can be generated by following steps [here](../Authentication%20flow%20for%20AzTS%20REST%20APIs.md#authentication-flow-for-azts-rest-apis). | No|

**Request Body**
|Name|Type|Description|Required?
|----|----|----|----|
| ScanRequestId |string| To get scan results with respect to the scan request id. | No |
| ControlIdList| List`<string`>|List of Control Ids to get scan results only for specific controls.| No |
| ResourceNameList | List`<string`>| List of resources to get scan results only for certain resources.| No |

**Response Body**
|Name|Type|Description|
|------|------|------|
| data | json object | Set of control scan result for requested subscription. |
| pageSize| int | Maximum records returned by the API at a time (i.e. 100). |
| skipToken | string | Contains the next page number to fetch the next set of records. API will not return skipToken, if the current requested page is the last page of API response. |
| totalPages | int | Represents total number of pages available to get all control scan result for requested subscription. |
| totalRecords | int | Represents total number of control scan result for requested subscription.|

<br/>

## **Example** 
<br/>

**Sample Request**

``` 
 POST https://AzSK-AzTS-WebApi-xxxxx/adhocscan/subscription/{subscriptionId}/ControlScanResult?api-version=1.0
```
<br/> 

**Sample Request Body**

```JSON
{
    "ScanRequestId":  "20210914014045"
}
```

**Sample Response**
> **Note:** The response object shown here might be shortened for readability.

``` JSON
{
    "data":
    [
        {
            "ControlName": "Azure_Storage_DP_Encrypt_In_Transit",
            "ControlDisplayName": "Enable Secure transfer to storage accounts",
            "Status": "Failed",
            "ResourceName": "htc-str-pre-prod-1",
            "ResourceGroupName": "TestRG",
            "ResourceID": "/subscriptions/48f73dab-a34c-49a5-b5f5-db1285d422c/resourceGroups/HTCRG/providers/Microsoft.Storage/storageAccounts/htc-str-pre-prod-1",
            "IsBaseline": "true",
            "Severity": "High",
            "StatusReason": "Storage secure transfer is not enabled",
            "SubscriptionId": "48f73dab-a34c-49a5-b5f5-db1285d422c",
            "OrgTenantId": "524c134f-eae7-4d9e-b007-ebf8f9d6468f",
            "ExceptionExpiryDate": "",
            "Justification": "",
            "Description": "HTTPS protocol must be used for accessing Storage Account resources",
            "Category": "Encrypt data in transit",
            "Remediation": "Run command 'Set-AzStorageAccount -ResourceGroupName <RGName> -Name <StorageAccountName> -EnableHttpsTrafficOnly `$true'. Run 'Get-Help Set-AzStorageAccount -full' for more help.",
            "ExceptionWorkFlowStatus": ""
        }
    ],
    "pageSize": 100,
    "skipToken": "eyJQYWdlTnVtYmVyIjoyfQ==",
    "totalPages": 5,
    "totalRecords": 450,    
}
```

To get the next page of the results, send a request to the URL with skipToken. The skipToken contains next page number of control scan result. Continue sending requests with the skipToken until it no longer contains a skipToken in the returned results.

**Sample Request**

``` 
 POST https://AzSK-AzTS-WebApi-xxxxx/adhocscan/subscription/{subscriptionId}/ControlScanResult?api-version=1.0&skipToken=eyJQYWdlTnVtYmVyIjoyfQ==
```
<br/> 

> **Note:**
> 1. If 'RequestBody' is empty or scanRequestId is in the past, then API will return latest scan results.
> 2. You can get scan results <b>only for one subscription at a time</b>.    
